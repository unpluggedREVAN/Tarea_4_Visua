<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treemap Squarify with D3.js</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .node {
            border: solid 1px white;
            font: 10px sans-serif;
            line-height: 12px;
            overflow: hidden;
            position: absolute;
            text-align: center;
        }
    </style>
</head>
<body>
    <script>
        const width = 960;
        const height = 570;

        const color = d3.scaleOrdinal(d3.schemeCategory10);

        const treemap = d3.treemap()
            .tile(d3.treemapSquarify)
            .size([width, height])
            .paddingInner(1)
            .round(true);

        d3.json("https://visualizacion-tec.netlify.app/flare.json").then(data => {
            const root = d3.hierarchy(data)
                .eachBefore(d => d.data.id = (d.parent ? d.parent.data.id + "." : "") + d.data.name)
                .sum(d => d.size)
                .sort((a, b) => b.height - a.height || b.value - a.value);

            treemap(root);

            const svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .style("font-family", "sans-serif");

            const node = svg.selectAll(".node")
                .data(root.leaves())
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x0},${d.y0})`);

            node.append("rect")
                .attr("id", d => d.data.id)
                .attr("width", d => d.x1 - d.x0)
                .attr("height", d => d.y1 - d.y0)
                .attr("fill", d => color(d.parent.data.id));

            node.append("clipPath")
                .attr("id", d => `clip-${d.data.id}`)
                .append("use")
                .attr("xlink:href", d => `#${d.data.id}`);

            node.append("text")
                .attr("clip-path", d => `url(#clip-${d.data.id})`)
                .selectAll("tspan")
                .data(d => d.data.name.split(/(?=[A-Z][^A-Z])/g))
                .enter().append("tspan")
                .attr("x", 3)
                .attr("y", (d, i) => 13 + i * 10)
                .text(d => d);

            node.append("title")
                .text(d => `${d.data.id}\n${d.value}`);
        });
    </script>
</body>
</html>
